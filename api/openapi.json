{
  "openapi": "3.1.0",
  "info": {
    "title": "ScyllaDB Vector Store API",
    "description": "REST API for ScyllaDB Vector Store indexing service. Provides capabilities for executing vector search queries, managing indexes, and checking service status.",
    "license": {
      "name": "LicenseRef-ScyllaDB-Source-Available-1.0"
    },
    "version": "1.3.0"
  },
  "paths": {
    "/api/v1/indexes": {
      "get": {
        "tags": [
          "scylla-vector-store-index"
        ],
        "description": "Returns the list of indexes managed by the Vector Store indexing service. The list includes indexes in any state (initializing, available/built, destroying). Due to synchronization delays, it may temporarily differ from the list of vector indexes inside ScyllaDB.",
        "operationId": "get_indexes",
        "responses": {
          "200": {
            "description": "Successful operation. Returns an array of index information representing all indexes managed by the Vector Store.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/IndexInfo"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/indexes/{keyspace}/{index}/ann": {
      "post": {
        "tags": [
          "scylla-vector-store-index"
        ],
        "description": "Performs an Approximate Nearest Neighbor (ANN) search using the specified index. Returns the vectors most similar to the provided vector. The maximum number of results is controlled by the optional 'limit' parameter in the payload. The similarity metric is determined at index creation and cannot be changed per query. If TLS is enabled on the server, clients must connect using a HTTPS protocol.",
        "operationId": "post_index_ann",
        "parameters": [
          {
            "name": "keyspace",
            "in": "path",
            "description": "The name of the ScyllaDB keyspace containing the vector index.",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/KeyspaceName"
            }
          },
          {
            "name": "index",
            "in": "path",
            "description": "The name of the ScyllaDB vector index within the specified keyspace to perform the search on.",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/IndexName"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PostIndexAnnRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful ANN search. Returns a list of primary keys and their corresponding distances for the most similar vectors found.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PostIndexAnnResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request. Possible causes: invalid vector size, malformed input, or missing required fields.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          },
          "403": {
            "description": "Bad request. The TLS is enabled in a configuration, but client connected over the plain HTTP.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          },
          "404": {
            "description": "Index not found. Possible causes: index does not exist, or is not discovered yet.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          },
          "500": {
            "description": "Error while searching vectors. Possible causes: internal error, or search engine issues.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable. Indicates that a full scan of the index is in progress and the search cannot be performed at this time.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/indexes/{keyspace}/{index}/status": {
      "get": {
        "tags": [
          "scylla-vector-store-index"
        ],
        "description": "Retrieves the current operational status and vector count for a specific vector index. The response includes the index's state and the total number of vectors currently indexed (excluding tombstoned or deleted entries). This endpoint enables clients to monitor index readiness and data availability for search operations.",
        "operationId": "get_index_status",
        "parameters": [
          {
            "name": "keyspace",
            "in": "path",
            "description": "The name of the ScyllaDB keyspace containing the vector index.",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/KeyspaceName"
            }
          },
          {
            "name": "index",
            "in": "path",
            "description": "The name of the ScyllaDB vector index within the specified keyspace to check status of.",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/IndexName"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation. Returns the current operational status of the specified vector index, including its state and the total number of vectors currently indexed.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IndexStatusResponse"
                },
                "example": {
                  "count": 12345,
                  "status": "SERVING"
                }
              }
            }
          },
          "404": {
            "description": "Index not found. Possible causes: index does not exist, or is not discovered yet.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          },
          "500": {
            "description": "Error while checking index state or counting vectors. Possible causes: internal error, or issues accessing the database.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorMessage"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/info": {
      "get": {
        "tags": [
          "scylla-vector-store-info"
        ],
        "description": "Returns information about the Vector Store indexing service serving this API.",
        "operationId": "get_info",
        "responses": {
          "200": {
            "description": "Vector Store indexing service information.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InfoResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/status": {
      "get": {
        "tags": [
          "scylla-vector-store-info"
        ],
        "description": "Returns the current operational status of the Vector Store indexing service.",
        "operationId": "get_status",
        "responses": {
          "200": {
            "description": "Successful operation. Returns the current operational status of the Vector Store indexing service.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NodeStatus"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ColumnName": {
        "type": "string",
        "description": "Name of the column in a db table."
      },
      "DataType": {
        "type": "string",
        "description": "Data type and precision used for storing and processing vectors in the index.",
        "enum": [
          "F32"
        ]
      },
      "Distance": {
        "type": "number",
        "format": "float",
        "description": "Distance between vectors measured using the distance function defined while creating the index."
      },
      "ErrorMessage": {
        "type": "string",
        "description": "A human-readable description of the error that occurred."
      },
      "IndexInfo": {
        "type": "object",
        "description": "Information about a vector index, such as keyspace, name and data type.",
        "required": [
          "keyspace",
          "index",
          "data_type"
        ],
        "properties": {
          "data_type": {
            "$ref": "#/components/schemas/DataType"
          },
          "index": {
            "$ref": "#/components/schemas/IndexName"
          },
          "keyspace": {
            "$ref": "#/components/schemas/KeyspaceName"
          }
        }
      },
      "IndexName": {
        "type": "string",
        "description": "A name of the vector index in a db."
      },
      "IndexStatus": {
        "type": "string",
        "description": "Operational status of the vector index.",
        "enum": [
          "INITIALIZING",
          "BOOTSTRAPPING",
          "SERVING"
        ],
        "x-enum-descriptions": [
          "The index has been discovered and is being initialized.",
          "The index is performing the initial full scan of the underlying table to populate the index.",
          "The index has completed the initial table scan. It is now monitoring the database for changes."
        ]
      },
      "IndexStatusResponse": {
        "type": "object",
        "required": [
          "status",
          "count"
        ],
        "properties": {
          "count": {
            "type": "integer",
            "minimum": 0
          },
          "status": {
            "$ref": "#/components/schemas/IndexStatus"
          }
        }
      },
      "InfoResponse": {
        "type": "object",
        "required": [
          "engine",
          "service",
          "version"
        ],
        "properties": {
          "engine": {
            "type": "string",
            "description": "Information about the underlying search engine."
          },
          "service": {
            "type": "string",
            "description": "The name of the Vector Store indexing service."
          },
          "version": {
            "type": "string",
            "description": "The version of the Vector Store indexing service."
          }
        }
      },
      "KeyspaceName": {
        "type": "string",
        "description": "A keyspace name in a db."
      },
      "Limit": {
        "type": "integer",
        "format": "int32"
      },
      "NodeStatus": {
        "type": "string",
        "description": "Operational status of the Vector Store indexing service.",
        "enum": [
          "INITIALIZING",
          "CONNECTING_TO_DB",
          "BOOTSTRAPPING",
          "SERVING"
        ],
        "x-enum-descriptions": [
          "The node is starting up.",
          "The node is establishing a connection to ScyllaDB.",
          "The node is discovering available vector indexes in ScyllaDB.",
          "The node has completed the initial database scan and built the indexes defined at that time. It is now monitoring the database for changes."
        ]
      },
      "PostIndexAnnFilter": {
        "type": "object",
        "description": "A filter used in ANN search requests.",
        "required": [
          "restrictions"
        ],
        "properties": {
          "allow_filtering": {
            "type": "boolean",
            "description": "Indicates whether 'ALLOW FILTERING' was specified in the Cql query."
          },
          "restrictions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PostIndexAnnRestriction"
            },
            "description": "A list of filter restrictions."
          }
        }
      },
      "PostIndexAnnRequest": {
        "type": "object",
        "required": [
          "vector"
        ],
        "properties": {
          "filter": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/PostIndexAnnFilter"
              }
            ]
          },
          "limit": {
            "$ref": "#/components/schemas/Limit"
          },
          "vector": {
            "$ref": "#/components/schemas/Vector"
          }
        }
      },
      "PostIndexAnnResponse": {
        "type": "object",
        "required": [
          "primary_keys",
          "distances"
        ],
        "properties": {
          "distances": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Distance"
            }
          },
          "primary_keys": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {}
            },
            "propertyNames": {
              "type": "string",
              "description": "Name of the column in a db table."
            }
          }
        }
      },
      "PostIndexAnnRestriction": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {},
              "type": {
                "type": "string",
                "enum": [
                  "=="
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "IN"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {},
              "type": {
                "type": "string",
                "enum": [
                  "<"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {},
              "type": {
                "type": "string",
                "enum": [
                  "<="
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {},
              "type": {
                "type": "string",
                "enum": [
                  ">"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "$ref": "#/components/schemas/ColumnName"
              },
              "rhs": {},
              "type": {
                "type": "string",
                "enum": [
                  ">="
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "()==()"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {
                  "type": "array",
                  "items": {}
                }
              },
              "type": {
                "type": "string",
                "enum": [
                  "()IN()"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "()<()"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "()<=()"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "()>()"
                ]
              }
            }
          },
          {
            "type": "object",
            "required": [
              "lhs",
              "rhs",
              "type"
            ],
            "properties": {
              "lhs": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ColumnName"
                }
              },
              "rhs": {
                "type": "array",
                "items": {}
              },
              "type": {
                "type": "string",
                "enum": [
                  "()>=()"
                ]
              }
            }
          }
        ],
        "description": "A filter restriction used in ANN search requests."
      },
      "Vector": {
        "type": "array",
        "items": {
          "type": "number",
          "format": "float"
        },
        "description": "The vector to use for the Approximate Nearest Neighbor search. The format of data must match the data_type of the index."
      }
    }
  },
  "tags": [
    {
      "name": "scylla-vector-store-index",
      "description": "Operations for managing ScyllaDB Vector Store indexes, including listing, counting, and searching."
    },
    {
      "name": "scylla-vector-store-info",
      "description": "Endpoints providing general information and status about the ScyllaDB Vector Store indexing service."
    }
  ]
}
